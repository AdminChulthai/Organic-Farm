<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Organic Farm</title>
    
    <link rel="icon" type="image/png" href="https://i.postimg.cc/x1zXPDk9/images-3.png">
    <link rel="apple-touch-icon" href="https://i.postimg.cc/x1zXPDk9/images-3.png"> 
    
    <style>
        /* ปรับสไตล์พื้นหลังให้ขาวสะอาดเหมือนแอปหลัก */
        body, html { 
            margin: 0; padding: 0; width: 100%; height: 100%; 
            overflow: hidden; background-color: #ffffff;
            font-family: 'Sarabun', sans-serif;
        }
        iframe { 
            width: 100%; height: 100%; border: none; display: block; 
        }
        
        /* Splash Screen ปรับสีให้ตรงกับ index.html */
        #splash-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #ffffff; 
            display: none; 
            flex-direction: column; align-items: center; justify-content: center;
            z-index: 10000;
        }

        /* โครงของเส้นพลัง (เหมือนกับแอปหลัก) */
        .energy-container {
            width: 70%;
            max-width: 300px;
            height: 6px;
            background: rgba(0, 0, 0, 0.05);
            border-radius: 10px;
            overflow: hidden;
            position: relative;
            margin-bottom: 20px;
        }

        /* ตัวเส้นพลังที่วิ่ง (ใช้ Gradient สีเดียวกันเป๊ะ) */
        .energy-line {
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, #27ae60, #2ecc71, #27ae60);
            background-size: 200% 100%;
            position: absolute;
            top: 0;
            left: -100%;
            animation: energy-flow 1.5s cubic-bezier(0.4, 0, 0.2, 1) infinite;
        }

        @keyframes energy-flow {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        .loading-text {
            font-size: 1rem;
            font-weight: 600;
            color: #27ae60;
            letter-spacing: 1px;
            animation: pulse-text 1.5s ease-in-out infinite;
        }

        @keyframes pulse-text {
            0%, 100% { opacity: 0.6; }
            50% { opacity: 1; }
        }

        /* ปุ่มสำรองในกรณีฉุกเฉิน */
        .fallback-link {
            margin-top: 30px;
            color: #27ae60;
            text-decoration: none;
            border: 2px solid #27ae60;
            padding: 10px 20px;
            border-radius: 50px;
            font-weight: bold;
            display: none;
        }
    </style>
</head>
<body>

    <div id="splash-screen">
        <div class="energy-container">
            <div class="energy-line"></div>
        </div>
        <div class="loading-text">กำลังเชื่อมต่อระบบฟาร์ม...</div>
        <a id="fallback-link" href="#" class="fallback-link">คลิกเพื่อใช้งานใน Chrome</a>
    </div>

    <!-- Iframe หลักที่ดึงแอปจาก Google -->
    <iframe 
        id="app-frame"
        src="https://script.google.com/macros/s/AKfycbwuYQC_KyLMaXctElQsqQ6waQjglMN-u9aXOsHpj3ZjKCc2Zrx7TvPTUkRzAKp30Zaf/exec"
        allow="camera; microphone; geolocation"
        allowfullscreen>
    </iframe>

    <script>
        const gasUrl = "https://script.google.com/macros/s/AKfycbwuYQC_KyLMaXctElQsqQ6waQjglMN-u9aXOsHpj3ZjKCc2Zrx7TvPTUkRzAKp30Zaf/exec";
        const githubUrl = window.location.href;

        function init() {
            const ua = navigator.userAgent || navigator.vendor || window.opera;
            const isAndroid = /Android/i.test(ua);
            const isInApp = /Line|FBAN|FBAV|Instagram|Messenger/i.test(ua);

            if (isAndroid && isInApp) {
                // แสดงผลเส้นพลังทันทีในหน้าลอยของ LINE
                document.getElementById('splash-screen').style.display = 'flex';
                
                // คำสั่งดีดตัวออกไปเปิดใน Chrome
                const chromeIntent = `intent://${githubUrl.replace(/^https?:\/\//, '')}#Intent;scheme=https;package=com.android.chrome;end`;
                window.location.href = chromeIntent;
                
                // แสดงปุ่มสำรองหลังจาก 4 วินาที หากระบบไม่เด้งอัตโนมัติ
                setTimeout(() => {
                    const link = document.getElementById('fallback-link');
                    link.href = githubUrl;
                    link.style.display = 'inline-block';
                }, 4000);
            } else {
                // หากอยู่ใน Chrome หรือ iOS แล้ว ไม่ต้องแสดงเส้นพลังของหน้านี้ 
                // ปล่อยให้ Iframe โหลดเส้นพลังของตัวแอปหลักเอง เพื่อความเนียน
                console.log("Normal browser detected. Loading main app...");
            }
        }

        // เริ่มทำงานทันที
        init();
    </script>
</body>
</html>
